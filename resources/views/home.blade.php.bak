@extends('layouts.app')

@section('title', 'Beranda - Portfolio Hub')

@section('content')
    <!-- Hero Section -->
    <div style="background: linear-gradient(135deg, #2563EB 0%, #1E40AF 50%, #1E3A8A 100%); position: relative; overflow: hidden; padding: 7rem 1rem 5rem;">
        <!-- Animated Background -->
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.08;">
            <div style="position: absolute; top: -50%; right: -10%; width: 500px; height: 500px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
            <div style="position: absolute; bottom: -30%; left: -5%; width: 400px; height: 400px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
        </div>

        <div class="container-main position-relative" style="text-align: center; color: white; max-width: 900px; margin-left: auto; margin-right: auto;">
            <div style="animation: slideInDown 0.8s ease-out;">
                <h1 style="font-size: 3.2rem; font-weight: 800; margin-bottom: 1.25rem; line-height: 1.25; letter-spacing: -1px;">
                    Showcase Your Best Work
                </h1>
                <p style="font-size: 1.1rem; margin-bottom: 2.5rem; opacity: 0.95; font-weight: 400; line-height: 1.6; max-width: 600px; margin-left: auto; margin-right: auto;">
                    Temukan inspirasi dari portfolio terbaik creator, designer, dan developer. Bagikan karya Anda dan bangun reputasi profesional.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                    @guest
                        <a href="{{ route('register') }}" style="background: white; color: #2563EB; padding: 0.875rem 2rem; border-radius: 8px; font-weight: 600; text-decoration: none; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)';">
                            <i class="fas fa-user-plus"></i> Daftar Gratis Sekarang
                        </a>
                    @endguest
                    <a href="#portfolio-list" style="background: rgba(255,255,255,0.15); color: white; padding: 0.875rem 2rem; border-radius: 8px; font-weight: 600; text-decoration: none; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; border: 1px solid rgba(255,255,255,0.3);" onmouseover="this.style.background='rgba(255,255,255,0.25)'; this.style.transform='translateY(-3px)';" onmouseout="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(0)';">
                        <i class="fas fa-arrow-down"></i> Jelajahi Portfolio
                    </a>
                </div>
            </div>

            <!-- Stats -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 2rem; margin-top: 5rem; max-width: 600px; margin-left: auto; margin-right: auto;">
                <div style="animation: fadeInUp 1s ease-out 0.2s both;">
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">1,200+</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; font-weight: 500;">Portfolio</div>
                </div>
                <div style="animation: fadeInUp 1s ease-out 0.4s both;">
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">450+</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; font-weight: 500;">Creator</div>
                </div>
                <div style="animation: fadeInUp 1s ease-out 0.6s both;">
                    <div style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">50K+</div>
                    <div style="font-size: 0.9rem; opacity: 0.9; font-weight: 500;">Pengunjung</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Portfolio Section -->
    <div class="container-main">
        <div id="portfolio-list" style="margin-top: 2rem;">
            <!-- Section Header -->
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 3rem; flex-wrap: wrap; gap: 2rem;">
                <div>
                    <h2 style="font-size: 2.2rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--dark-color);">
                        {{ $search ? 'üîç Hasil Pencarian' : '‚ú® Portfolio Terbaru' }}
                    </h2>
                    <p style="color: var(--gray-600); margin: 0; font-weight: 500;">
                        {{ $search ? 'Hasil untuk: ' . $search : 'Karya terbaik dari komunitas kami' }}
                    </p>
                </div>
                @auth
                    @if(!Auth::user()->isAdmin())
                        <a href="{{ route('portfolio.create') }}" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-light)); color: white; padding: 0.875rem 1.75rem; border-radius: 8px; font-weight: 600; text-decoration: none; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; height: fit-content; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(37, 99, 235, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(37, 99, 235, 0.3)';">
                            <i class="fas fa-plus"></i> Buat Portfolio
                        </a>
                    @endif
                @endauth
            </div>

            <!-- Search Bar -->
            <div style="margin-bottom: 2rem;">
                <form method="GET" action="{{ route('home') }}" style="display: flex; gap: 0.75rem;">
                    <div style="flex: 1; position: relative; max-width: 500px;">
                        <input 
                            type="text" 
                            name="q" 
                            value="{{ $search ?? '' }}"
                            placeholder="üîç Cari portfolio, creator, atau skills..."
                            style="width: 100%; padding: 0.875rem 1.25rem; border: 1.5px solid var(--gray-300); border-radius: 8px; font-size: 0.95rem; transition: all 0.3s ease;"
                            onfocus="this.style.borderColor='var(--primary-color)'; this.style.boxShadow='0 0 0 3px rgba(37, 99, 235, 0.1)';"
                            onblur="this.style.borderColor='var(--gray-300)'; this.style.boxShadow='none';">
                    </div>
                    <button type="submit" style="background: linear-gradient(135deg, var(--primary-color), var(--primary-light)); color: white; padding: 0.875rem 1.75rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(37, 99, 235, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(37, 99, 235, 0.3)';">
                        <i class="fas fa-search"></i> Cari
                    </button>
                    @if($search)
                        <a href="{{ route('home') }}" style="background: var(--gray-200); color: var(--primary-color); padding: 0.875rem 1.75rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease;" onmouseover="this.style.background='var(--gray-300)';" onmouseout="this.style.background='var(--gray-200)';">
                            <i class="fas fa-times"></i> Bersihkan
                        </a>
                    @endif
                </form>
            </div>

            @if($portfolios->count() > 0)
                <!-- Portfolio Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; margin-bottom: 3rem;">
                    @foreach($portfolios as $portfolio)
                        <div class="portfolio-card" style="animation: fadeInUp 0.6s ease-out;">
                            
                            <!-- Image Section -->
                            <div style="position: relative; height: 280px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%); overflow: hidden;">
                                @if($portfolio->image_url)
                                    <img src="{{ $portfolio->image_url }}" alt="{{ $portfolio->title }}" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                                @else
                                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-image" style="font-size: 3rem; color: rgba(255,255,255,0.2);"></i>
                                    </div>
                                @endif
                                <!-- Category Badge -->
                                <div style="position: absolute; top: 1rem; right: 1rem;">
                                    <span style="background: rgba(255,255,255,0.97); color: var(--primary-color); padding: 0.45rem 0.9rem; border-radius: 6px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; backdrop-filter: blur(10px); box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
                                        {{ Str::limit($portfolio->category, 15) }}
                                    </span>
                                </div>
                                <!-- Highlight Badge -->
                                @if($portfolio->is_highlighted && (!$portfolio->highlighted_until || $portfolio->highlighted_until > now()))
                                    <div style="position: absolute; top: 1rem; left: 1rem; background: linear-gradient(135deg, #F59E0B, #EF4444); color: white; padding: 0.5rem 0.9rem; border-radius: 6px; font-size: 0.7rem; font-weight: 700; display: flex; align-items: center; gap: 0.4rem; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);">
                                        <i class="fas fa-star"></i> SOROT
                                    </div>
                                @endif
                                    <!-- View Count Badge -->
                                    <div style="position: absolute; bottom: 1rem; left: 1rem; background: rgba(0,0,0,0.5); color: white; padding: 0.3rem 0.8rem; border-radius: 6px; font-size: 0.8rem; display: flex; align-items: center; gap: 0.3rem; backdrop-filter: blur(10px);">
                                        <i class="fas fa-eye"></i> {{ $portfolio->views }}
                                    </div>
                                </div>

                                <!-- Content Section -->
                                <div style="padding: 1.5rem; flex-grow: 1; display: flex; flex-direction: column;">
                                    <!-- Title -->
                                    <h3 style="font-size: 1.2rem; font-weight: 700; margin-bottom: 0.5rem; line-height: 1.4; color: #1a202c;">
                                        <a href="{{ route('portfolio.show', $portfolio) }}" style="color: inherit; text-decoration: none; transition: color 0.3s ease;" onmouseover="this.style.color='#667eea';" onmouseout="this.style.color='#1a202c';">
                                            {{ Str::limit($portfolio->title, 45) }}
                                        </a>
                                    </h3>

                                    <!-- Description -->
                                    <p style="color: #666; font-size: 0.95rem; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex-grow: 1;">
                                        {{ Str::limit($portfolio->description, 100) }}
                                    </p>

                                    <!-- Technologies -->
                                    @if($portfolio->technologies)
                                        <div style="margin-bottom: 1rem;">
                                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                                @foreach(explode(', ', Str::limit($portfolio->technologies, 40)) as $tech)
                                                    <span style="background: #f0f2f5; color: #667eea; padding: 0.3rem 0.7rem; border-radius: 6px; font-size: 0.8rem; font-weight: 500;">
                                                        {{ trim($tech) }}
                                                    </span>
                                                @endforeach
                                            </div>
                                        </div>
                                    @endif

                                    <!-- User Info -->
                                    <div style="padding-top: 1rem; border-top: 1px solid #f0f2f5; margin-bottom: 1rem;">
                                        <a href="{{ route('profile.show', $portfolio->user) }}" style="text-decoration: none; display: flex; align-items: center; gap: 0.75rem; transition: all 0.3s ease;">
                                            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 0.9rem; flex-shrink: 0; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                                {{ strtoupper(substr($portfolio->user->name, 0, 1)) }}
                                            </div>
                                            <div style="flex: 1; min-width: 0;">
                                                <div style="font-weight: 600; color: #1a202c; font-size: 0.95rem; transition: color 0.3s ease;" onmouseover="this.style.color='#667eea';" onmouseout="this.style.color='#1a202c';">{{ $portfolio->user->name }}</div>
                                                <div style="color: #999; font-size: 0.8rem;">@{{ $portfolio->user->username ?? 'creator' }}</div>
                                            </div>
                                        </a>
                                    </div>

                                    <!-- Stats & Actions -->
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <div style="display: flex; gap: 1rem; flex: 1; font-size: 0.9rem; color: #666;">
                                            <div style="display: flex; align-items: center; gap: 0.3rem;">
                                                <i class="fas fa-heart" style="color: #ff6b6b;"></i>
                                                <span>{{ $portfolio->likes_count ?? 0 }}</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 0.3rem;">
                                                <i class="fas fa-comment" style="color: #4c72b0;"></i>
                                                <span>{{ $portfolio->comments_count ?? 0 }}</span>
                                            </div>
                                        </div>
                                        @auth
                                            @if(Auth::user()->isCreator())
                                                <button onclick="toggleLike({{ $portfolio->id }})" style="background: transparent; border: 1px solid #f0f2f5; color: #667eea; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;" data-like-btn="{{ $portfolio->id }}" onmouseover="this.style.background='#f0f2f5';" onmouseout="this.style.background='transparent';">
                                                    @if($portfolio->liked(Auth::id()))
                                                        <i class="fas fa-heart" style="color: #ff6b6b;"></i>
                                                    @else
                                                        <i class="far fa-heart"></i>
                                                    @endif
                                                </button>
                                            @elseif(Auth::user()->isCompany())
                                                <button onclick="saveCreator({{ $portfolio->user->id }})" style="background: transparent; border: 1px solid #f0f2f5; color: #667eea; width: 40px; height: 40px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;" data-save-btn="{{ $portfolio->user->id }}" onmouseover="this.style.background='#f0f2f5';" onmouseout="this.style.background='transparent';">
                                                    <i class="fas fa-bookmark"></i>
                                                </button>
                                            @endif
                                        @endauth
                                    </div>
                                </div>

                                <!-- Action Button -->
                                <div style="padding: 1rem 1.5rem; border-top: 1px solid #f0f2f5; background: #fafbfc;">
                                    <a href="{{ route('portfolio.show', $portfolio) }}" style="display: block; text-align: center; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.75rem 1rem; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.3)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                        <i class="fas fa-eye"></i> Lihat Detail
                                    </a>
                                </div>
                            </div>
                        </div>
                    @endforeach
                </div>

                <!-- Pagination - Modern Style -->
                <div style="display: flex; justify-content: center; margin-top: 4rem;">
                    <div style="display: flex; gap: 0.5rem;">
                        {{ $portfolios->links(view: 'pagination.custom') }}
                    </div>
                </div>
            @else
                <!-- Empty State -->
                <div style="text-align: center; padding: 4rem 2rem; background: linear-gradient(135deg, #f5f7fa 0%, #f0f2f5 100%); border-radius: 16px; margin: 2rem 0;">
                    <i class="fas fa-inbox" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <h3 style="color: #1a202c; margin-bottom: 0.5rem; font-size: 1.3rem;">Belum ada portfolio</h3>
                    <p style="color: #666; margin-bottom: 1.5rem; font-size: 0.95rem;">Jadilah yang pertama membagikan karya menakjubkan Anda</p>
                    @guest
                        <a href="{{ route('register') }}" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(102, 126, 234, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <i class="fas fa-user-plus"></i> Daftar Sekarang
                        </a>
                    @else
                        <a href="{{ route('portfolio.create') }}" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(102, 126, 234, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <i class="fas fa-plus"></i> Buat Portfolio Pertama
                        </a>
                    @endguest
                </div>
            @endif
        </div>
    </div>
@endsection

@section('js')
    <style>
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .z-1 {
            position: relative;
            z-index: 1;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Image hover effect */
        [class*="card"] img {
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        [class*="card"]:hover img {
            transform: scale(1.08);
        }
    </style>

    <script>
        // Animasi pada scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.style.animation = 'fadeInUp 0.6s ease-out forwards';
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // Observe semua elemen dengan animation
        document.querySelectorAll('[style*="animation"]').forEach((el) => {
            el.style.opacity = '0';
            observer.observe(el);
        });

        // Like toggle dengan AJAX dan update counter
        function toggleLike(portfolioId) {
            const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            const btn = document.querySelector(`[data-like-btn="${portfolioId}"]`);
            
            fetch(`/portfolio/${portfolioId}/like`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': token
                }
            })
            .then(response => {
                if (response.status === 401) {
                    window.location.href = '{{ route("login") }}';
                    return;
                }
                return response.json();
            })
            .then(data => {
                if (data && btn) {
                    // Update button
                    if (data.liked) {
                        btn.innerHTML = '<i class="fas fa-heart" style="color: #ff6b6b;"></i>';
                        btn.style.color = '#ff6b6b';
                    } else {
                        btn.innerHTML = '<i class="far fa-heart"></i>';
                        btn.style.color = '#667eea';
                    }
                    
                    // Animate button
                    btn.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        btn.style.transform = 'scale(1)';
                    }, 200);
                }
            })
            .catch(err => console.error(err));
        }

        // Save creator function untuk company
        function saveCreator(creatorId) {
            const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            const btn = document.querySelector(`[data-save-btn="${creatorId}"]`);
            
            fetch(`/company/save-creator/${creatorId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (btn) {
                    // Animate button
                    btn.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        btn.style.transform = 'scale(1)';
                    }, 200);
                    
                    // Update button style based on saved status
                    if (data.saved) {
                        btn.innerHTML = '<i class="fas fa-bookmark" style="color: #667eea;"></i>';
                        btn.style.color = '#667eea';
                    } else {
                        btn.innerHTML = '<i class="fas fa-bookmark"></i>';
                        btn.style.color = '#667eea';
                    }
                    
                    // Show toast message
                    showToast(data.message);
                }
            })
            .catch(err => console.error(err));
        }

        // Simple toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #667eea;
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 9999;
                animation: slideInUp 0.3s ease-out;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInUp 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Parallax effect pada hero
        window.addEventListener('scroll', function() {
            const hero = document.querySelector('div[style*="background: linear-gradient(135deg"]');
            if (hero && window.scrollY < window.innerHeight) {
                hero.style.backgroundPosition = `center ${window.scrollY * 0.5}px`;
            }
        });
    </script>
@endsection
